{
  "version": "2.0.0",
  "tasks": [
    // Setup
    {
      "label": "Setup project (UI deps + certs)",
      "type": "shell",
      "command": "make setup",
      "group": "build"
    },

    // Build
    {
      "label": "Build backend",
      "type": "shell",
      "command": "make build-backend",
      "group": "build"
    },
    {
      "label": "Build UI",
      "type": "shell",
      "command": "make build-ui",
      "group": "build"
    },
    {
      "label": "Build all",
      "type": "shell",
      "command": "make build",
      "group": "build"
    },

    // Run
    {
      "label": "Run backend (serve)",
      "type": "shell",
      "command": "make run",
      "group": "build"
    },

    // Quality
    {
      "label": "Test (Go)",
      "type": "shell",
      "command": "make test",
      "group": "test"
    },
    {
      "label": "Lint (Go)",
      "type": "shell",
      "command": "make lint",
      "group": "test"
    },
    {
      "label": "Go mod tidy",
      "type": "shell",
      "command": "make tidy",
      "group": "build"
    },
    {
      "label": "Clean",
      "type": "shell",
      "command": "make clean",
      "group": "build"
    },

    // Utilities
    {
      "label": "Health: backend",
      "type": "shell",
      "command": "make health",
      "group": "test"
    },
    {
      "label": "TLS check: backend 8090",
      "type": "shell",
      "command": "make tls-check-backend",
      "group": "test"
    },

    {
      "label": "Admin: stop all workloads",
      "type": "shell",
      "command": "make stop-all",
      "group": "test"
    },
    {
      "label": "Generate join config (guildnet.config)",
      "type": "shell",
      "command": "bash scripts/generate_join_config.sh --out \"${GN_JOIN_OUT:-guildnet.config}\"",
      "group": "build",
      "problemMatcher": []
    },
    {
      "label": "Verify cluster (script)",
      "type": "shell",
      "command": "bash -lc 'bash scripts/verify-cluster.sh 2>&1 | tee /tmp/verify-cluster-$(date +%s).log'",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": []
    },

    // Extras
    {
      "label": "Agent: build image",
      "type": "shell",
      "command": "make agent-build",
      "group": "build"
    }
    ,
    {
      "label": "Run server and tail logs",
      "type": "shell",
      "command": "bash -lc './scripts/stop-hostapp.sh || true; sudo rm -f /tmp/hostapp.log || true; sudo touch /tmp/hostapp.log; sudo chown \"$(id -u):$(id -g)\" /tmp/hostapp.log; nohup ./scripts/run-hostapp.sh > /tmp/hostapp.log 2>&1 & sleep 1; ps aux | grep hostapp | grep -v grep || true; tail -n +1 -F /tmp/hostapp.log'",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": true,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": []
    }
  ]
}
