{
  "version": "2.0.0",
  "tasks": [
    // Setup
    {
      "label": "Setup project (UI deps + certs)",
      "type": "shell",
      "command": "make setup",
      "group": "build"
    },

    // Build
    {
      "label": "Build backend",
      "type": "shell",
      "command": "make build-backend",
      "group": "build"
    },
    {
      "label": "Build UI",
      "type": "shell",
      "command": "make build-ui",
      "group": "build"
    },
    {
      "label": "Build all",
      "type": "shell",
      "command": "make build",
      "group": "build"
    },

    // Run
    {
      "label": "Run backend (serve)",
      "type": "shell",
      "command": "make run",
      "group": "build"
    },

    // Quality
    {
      "label": "Test (Go)",
      "type": "shell",
      "command": "make test",
      "group": "test"
    },
    {
      "label": "Lint (Go)",
      "type": "shell",
      "command": "make lint",
      "group": "test"
    },
    {
      "label": "Go mod tidy",
      "type": "shell",
      "command": "make tidy",
      "group": "build"
    },
    {
      "label": "Clean",
      "type": "shell",
      "command": "make clean",
      "group": "build"
    },

    // Utilities
    {
      "label": "Health: backend",
      "type": "shell",
      "command": "make health",
      "group": "test"
    },
    {
      "label": "TLS check: backend 8090",
      "type": "shell",
      "command": "make tls-check-backend",
      "group": "test"
    },

    {
      "label": "Admin: stop all workloads",
      "type": "shell",
      "command": "make stop-all",
      "group": "test"
    },
    {
      "label": "Generate join config (guildnet.config)",
      "type": "shell",
      "command": "bash scripts/create_join_info.sh --kubeconfig \"${GN_KUBECONFIG:-${KUBECONFIG:-$HOME/.kube/config}}\" --name \"${GN_CLUSTER_NAME:-}\" --hostapp-url \"${GN_HOSTAPP_URL:-https://127.0.0.1:8090}\" --include-ca \"${GN_INCLUDE_CA:-}\" --login-server \"${GN_LOGIN_SERVER:-}\" --auth-key \"${GN_AUTH_KEY:-}\" --hostname \"${GN_HOSTNAME:-$(hostname)}\" --out \"${GN_JOIN_OUT:-guildnet.config}\"",
      "group": "build",
      "problemMatcher": []
    },
    {
      "label": "Verify cluster (script)",
      "type": "shell",
      "command": "bash -lc 'bash scripts/verify-cluster.sh 2>&1 | tee /tmp/verify-cluster-$(date +%s).log'",
      "presentation": {
        "echo": true,
        "reveal": "always",
        "focus": false,
        "panel": "shared",
        "showReuseMessage": true,
        "clear": false
      },
      "problemMatcher": []
    },

    // Extras
    {
      "label": "Agent: build image",
      "type": "shell",
      "command": "make agent-build",
      "group": "build"
    }
  ]
}
